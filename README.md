# Personal NixOS Configuration

This flake defines NixOS and Home Manager setups for several machines, keeping shared pieces in reusable modules.

## Layout
- `flake.nix` – inputs (nixpkgs, home-manager), dev shell, formatter, and system outputs.
- `modules/` – reusable NixOS role modules (base, desktop, security, crypto, qemu).
- `hardware/` – hardware-specific profiles generated by `nixos-generate-config`.
- `hosts/` – per-host NixOS configurations that combine modules and hardware definitions.
- `home/` – Home Manager modules for user packages and desktop configuration.

## Usage
1. Set your preferred `username` once in `flake.nix` (under `specialArgs`), then adjust hostnames and any host-specific details in `hosts/*.nix` and `modules/base.nix`.
2. For a host, run (from this repo):
   ```bash
   sudo nixos-rebuild switch --flake .#<host>
   ```
3. Home Manager is enabled through the host modules; user packages and dotfiles are under `home/`.

## Notes
- Binary caches for `nixpkgs` and `nix-community` are configured in `flake.nix`.
- Unfree packages are allowed by default; set `config.allowUnfree = false;` in `flake.nix` if undesired.
- The virtualization role (`modules/qemu.nix`) appends `libvirtd` to the primary user without clobbering groups defined in `modules/base.nix`.
